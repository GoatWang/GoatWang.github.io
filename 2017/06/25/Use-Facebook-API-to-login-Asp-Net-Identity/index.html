<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-tw">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="C#," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon-20170422030939549.ico?v=5.1.0" />






<meta name="description" content="IntroductionDue to facebook api’s change on its query string. The built-in connecting system to facebook has some error. Unlike google authencation, you only have to input the ClientId, ClientSecret a">
<meta name="keywords" content="C#">
<meta property="og:type" content="article">
<meta property="og:title" content="Use Facebook API to login Asp.Net Identity">
<meta property="og:url" content="https://jeremy4555.github.io/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/index.html">
<meta property="og:site_name" content="Jeremy Wang's Blog">
<meta property="og:description" content="IntroductionDue to facebook api’s change on its query string. The built-in connecting system to facebook has some error. Unlike google authencation, you only have to input the ClientId, ClientSecret a">
<meta property="og:image" content="https://jeremy4555.github.io/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/01facebooktool.JPG">
<meta property="og:image" content="https://jeremy4555.github.io/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/1.JPG">
<meta property="og:image" content="https://jeremy4555.github.io/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/2.JPG">
<meta property="og:image" content="https://jeremy4555.github.io/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/3.JPG">
<meta property="og:image" content="https://jeremy4555.github.io/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/4.JPG">
<meta property="og:image" content="https://jeremy4555.github.io/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/5.JPG">
<meta property="og:image" content="https://jeremy4555.github.io/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/6.JPG">
<meta property="og:image" content="https://jeremy4555.github.io/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/7.JPG">
<meta property="og:image" content="https://jeremy4555.github.io/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/8.JPG">
<meta property="og:image" content="https://jeremy4555.github.io/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/9.JPG">
<meta property="og:image" content="https://jeremy4555.github.io/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/10.JPG">
<meta property="og:image" content="https://jeremy4555.github.io/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/11.JPG">
<meta property="og:image" content="https://jeremy4555.github.io/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/12.JPG">
<meta property="og:image" content="https://jeremy4555.github.io/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/13.JPG">
<meta property="og:image" content="https://jeremy4555.github.io/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/14.JPG">
<meta property="og:image" content="https://jeremy4555.github.io/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/15.JPG">
<meta property="og:image" content="https://jeremy4555.github.io/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/16.JPG">
<meta property="og:image" content="https://jeremy4555.github.io/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/17.JPG">
<meta property="og:image" content="https://jeremy4555.github.io/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/18.JPG">
<meta property="og:image" content="https://jeremy4555.github.io/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/19.JPG">
<meta property="og:image" content="https://jeremy4555.github.io/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/20.JPG">
<meta property="og:image" content="https://jeremy4555.github.io/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/21.JPG">
<meta property="og:image" content="https://jeremy4555.github.io/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/22FacebookError.JPG">
<meta property="og:updated_time" content="2017-06-25T00:18:19.225Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Use Facebook API to login Asp.Net Identity">
<meta name="twitter:description" content="IntroductionDue to facebook api’s change on its query string. The built-in connecting system to facebook has some error. Unlike google authencation, you only have to input the ClientId, ClientSecret a">
<meta name="twitter:image" content="https://jeremy4555.github.io/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/01facebooktool.JPG">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://jeremy4555.github.io/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/"/>





  <title> Use Facebook API to login Asp.Net Identity | Jeremy Wang's Blog </title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-tw">

  




<!-- hexo-inject:begin --><!-- hexo-inject:end --><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-101626873-1', 'auto');
  ga('send', 'pageview');
</script>











  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jeremy Wang's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Learning Note</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首頁
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分類
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            歸檔
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://jeremy4555.github.io/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeremy Wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://scontent-tpe1-1.xx.fbcdn.net/v/t1.0-9/15622747_1207299666013163_2211742436901915922_n.jpg?oh=f0ebf41169212e1b6bbdc1eeb65a6258&oe=597989BB">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jeremy Wang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Use Facebook API to login Asp.Net Identity
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              
              <time title="創建於" itemprop="dateCreated datePublished" datetime="2017-06-25T07:42:19+08:00">
                2017-06-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index">
                    <span itemprop="name">C#</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Due to facebook api’s change on its query string. The built-in connecting system to facebook has some error. Unlike google authencation, you only have to input the ClientId, ClientSecret and set down the google end app, then you can successfully connect to google Api. However, you have to redefine the querystring in facebook authencation.<a id="more"></a><br>To be mentioned, you can only get emails of users in default setting in both all approach of authencation. If you want to get username, some code have to be edit more complicatedly. Nevertheless, even if you know how to edit code to get more information of users from facebook(or google), the port of Asp.Net Indentity to third party authencation system can only allow you to ask for name and email.<br>This is restricted by Identity class. You can only get access to other private information by editing this calss’ inner code. This is quit different from other program language because Identity is supported by Microsoft. And other language’s methods to connect to third party api are often supported by third party.</p>
<h1 id="Tools-on-Facebook-Api"><a href="#Tools-on-Facebook-Api" class="headerlink" title="Tools on Facebook Api"></a>Tools on Facebook Api</h1><p>There are two tools on facebook api for you to do authencation process: “Facebook Login” and “Account Kit”. And this article focus on the second method.<br><img src="/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/01facebooktool.JPG" alt="01facebooktool.JPG" title=""></p>
<table>
<thead>
<tr>
<th>Item</th>
<th>connecting method</th>
<th>what you will get?</th>
<th>advantage</th>
</tr>
</thead>
<tbody>
<tr>
<td>facebook login</td>
<td>Front end(View) connection*</td>
<td>name</td>
<td>easy</td>
</tr>
<tr>
<td>Account Kit</td>
<td>Server end(Controller) connection</td>
<td>name, email, and other**</td>
<td>flexible</td>
</tr>
</tbody>
</table>
<p><em>*This way is quit easy. If you have some basic knowledge of javascript, you will successfully connect your view to facebook by reading its instruction. And you don’t have to use Identity class in this way.</em><br><em>**If you want more information, first you have to modify the inner code of Identity calss to fit facebook api’s requirement. second, you have to apply to facebook for asking agreement to other facebook users for more information. Third, every time a new user login your website through fb, they will be ask for authorization. Once they reject, you can get information they agree to give to you.</em></p>
<h1 id="Notice"><a href="#Notice" class="headerlink" title="Notice"></a>Notice</h1><p>By the way, the way to apply for a fb developer account is quit easy. And a lot of articles have complete this part. As a result, I don’t want to waist time and space to write again. So this article assume you have an fb developer account and you have got AppId and AppSecret from facebook. </p>
<h1 id="Open-Project-and-prepare-utility-for-Identity-class-to-use"><a href="#Open-Project-and-prepare-utility-for-Identity-class-to-use" class="headerlink" title="Open Project and prepare utility for Identity class to use"></a>Open Project and prepare utility for Identity class to use</h1><h2 id="Open-an-MVC-project-with-idntity"><a href="#Open-an-MVC-project-with-idntity" class="headerlink" title="Open an MVC project with idntity"></a>Open an MVC project with idntity</h2><img src="/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/1.JPG" alt="Open Asp.Net Application" title="Open Asp.Net Application">
<img src="/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/2.JPG" alt="Select MVC and Define validation" title="Select MVC and Define validation">
<h2 id="Create-FacebookBackChannelHandler-cs-class-file-in-fb-directory"><a href="#Create-FacebookBackChannelHandler-cs-class-file-in-fb-directory" class="headerlink" title="Create FacebookBackChannelHandler.cs class file in fb directory"></a>Create FacebookBackChannelHandler.cs class file in fb directory</h2><img src="/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/3.JPG" alt="Create Directory" title="Create Directory">
<img src="/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/4.JPG" alt="Create FacebookBackChannelHandler.cs" title="Create FacebookBackChannelHandler.cs">
<img src="/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/5.JPG" alt="Define this class inherited from HttpClientHandler" title="Define this class inherited from HttpClientHandler">
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FacebookBackChannelHandler</span> : <span class="title">HttpClientHandler</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">async</span> System.Threading.Tasks.<span class="function">Task&lt;HttpResponseMessage&gt; <span class="title">SendAsync</span>(<span class="params">HttpRequestMessage request, System.Threading.CancellationToken cancellationToken</span>)</span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span> (!request.RequestUri.AbsolutePath.Contains(<span class="string">"/oauth"</span>))</div><div class="line">        &#123;</div><div class="line">            <span class="comment">//Because fb has changed it querysteing format, so you have to redefine this to achieve its requirement.</span></div><div class="line">            <span class="comment">//Original: https://graph.facebook.com/v2.4/me?access_token=ABC</span></div><div class="line">            <span class="comment">//Now: https://graph.facebook.com/v2.4/me?fields=id,name,email&amp;access_token=ABC</span></div><div class="line">            request.RequestUri = <span class="keyword">new</span> Uri(request.RequestUri.AbsoluteUri.Replace(<span class="string">"?access_token"</span>, <span class="string">"&amp;access_token"</span>));</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">var</span> result = <span class="keyword">await</span> <span class="keyword">base</span>.SendAsync(request, cancellationToken);</div><div class="line">        <span class="keyword">if</span> (!request.RequestUri.AbsolutePath.Contains(<span class="string">"/oauth"</span>))</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">return</span> result;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">var</span> content = <span class="keyword">await</span> result.Content.ReadAsStringAsync();</div><div class="line">        <span class="keyword">var</span> facebookOauthResponse = JsonConvert.DeserializeObject&lt;FacebookOauthResponse&gt;(content);</div><div class="line"></div><div class="line">        <span class="keyword">var</span> outgoingQueryString = HttpUtility.ParseQueryString(<span class="keyword">string</span>.Empty);</div><div class="line">        outgoingQueryString.Add(<span class="string">"access_token"</span>, facebookOauthResponse.access_token);</div><div class="line">        outgoingQueryString.Add(<span class="string">"expires_in"</span>, facebookOauthResponse.expires_in + <span class="keyword">string</span>.Empty);</div><div class="line">        outgoingQueryString.Add(<span class="string">"token_type"</span>, facebookOauthResponse.token_type);</div><div class="line">        <span class="keyword">var</span> postdata = outgoingQueryString.ToString();</div><div class="line"></div><div class="line">        <span class="keyword">var</span> modifiedResult = <span class="keyword">new</span> HttpResponseMessage(HttpStatusCode.OK)</div><div class="line">        &#123;</div><div class="line">            Content = <span class="keyword">new</span> StringContent(postdata)</div><div class="line">        &#125;;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> modifiedResult;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FacebookOauthResponse</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">string</span> access_token &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">string</span> token_type &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> expires_in &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Modify-Startup-Auth"><a href="#Modify-Startup-Auth" class="headerlink" title="Modify Startup.Auth"></a>Modify Startup.Auth</h2><img src="/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/6.JPG" alt="Open Startup.Auth" title="Open Startup.Auth">
<img src="/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/7.JPG" alt="Modify Startup.Auth" title="Modify Startup.Auth">
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> facebookOptions = <span class="keyword">new</span> <span class="type">FacebookAuthenticationOptions</span>()</div><div class="line">&#123;</div><div class="line">    AppId = <span class="string">"&#123;&#123;Your AppId&#125;&#125;"</span>,</div><div class="line">    AppSecret = <span class="string">"&#123;&#123;Your AppSecret&#125;&#125;"</span>,</div><div class="line">    <span class="comment">//The class you have defined beforehand</span></div><div class="line">    BackchannelHttpHandler = <span class="keyword">new</span> <span class="type">FacebookBackChannelHandler</span>(),</div><div class="line">    <span class="comment">//You can difine facebook version yourdself(VX.X below)</span></div><div class="line">    UserInformationEndpoint = <span class="string">"https://graph.facebook.com/v2.4/me?fields=id,name,email"</span></div><div class="line">&#125;;</div><div class="line">app.UseFacebookAuthentication(facebookOptions);</div></pre></td></tr></table></figure>
<h2 id="Build-your-project"><a href="#Build-your-project" class="headerlink" title="Build your project"></a>Build your project</h2><pre><code>ctrl + shift + b
</code></pre><h1 id="Model-and-ViewModel"><a href="#Model-and-ViewModel" class="headerlink" title="Model and ViewModel"></a>Model and ViewModel</h1><h2 id="Edit-database-column-and-IdentityModel-cs"><a href="#Edit-database-column-and-IdentityModel-cs" class="headerlink" title="Edit database column and IdentityModel.cs"></a>Edit database column and IdentityModel.cs</h2><p>See notice in the tail of this article</p>
<h2 id="AccountViewModel-cs-get-username-from-view"><a href="#AccountViewModel-cs-get-username-from-view" class="headerlink" title="AccountViewModel.cs(get username from view)"></a>AccountViewModel.cs(get username from view)</h2><img src="/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/8.JPG" alt="Open AccountViewModels.cs" title="Open AccountViewModels.cs">
<img src="/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/9.JPG" alt="Modify ExternalLoginConfirmationViewModel" title="Modify ExternalLoginConfirmationViewModel">
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ExternalLoginConfirmationViewModel</span></div><div class="line">&#123;</div><div class="line">    [Required]</div><div class="line">    [Display(Name = <span class="string">"電子郵件"</span>)]</div><div class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Email &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line">    [Required]</div><div class="line">    [Display(Name = <span class="string">"姓名"</span>)]</div><div class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h1><h2 id="AccountController-cs-get-username-from-fb"><a href="#AccountController-cs-get-username-from-fb" class="headerlink" title="AccountController.cs(get username from fb)"></a>AccountController.cs(get username from fb)</h2><img src="/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/10.JPG" alt="Open AccountController.cs" title="Open AccountController.cs">
<h3 id="ExternalLoginCallback-Action"><a href="#ExternalLoginCallback-Action" class="headerlink" title="ExternalLoginCallback Action"></a>ExternalLoginCallback Action</h3><img src="/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/11.JPG" alt="Modify ExternalLoginCallback Action" title="Modify ExternalLoginCallback Action">
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">[AllowAnonymous]</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;ActionResult&gt; <span class="title">ExternalLoginCallback</span>(<span class="params"><span class="keyword">string</span> returnUrl</span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">var</span> loginInfo = <span class="keyword">await</span> AuthenticationManager.GetExternalLoginInfoAsync();</div><div class="line">    <span class="keyword">if</span> (loginInfo == <span class="literal">null</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> RedirectToAction(<span class="string">"Login"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> result = <span class="keyword">await</span> SignInManager.ExternalSignInAsync(loginInfo, isPersistent: <span class="literal">false</span>);</div><div class="line">    <span class="keyword">switch</span> (result)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">case</span> SignInStatus.Success:</div><div class="line">            <span class="keyword">return</span> RedirectToLocal(returnUrl);</div><div class="line">        <span class="keyword">case</span> SignInStatus.LockedOut:</div><div class="line">            <span class="keyword">return</span> View(<span class="string">"Lockout"</span>);</div><div class="line">        <span class="keyword">case</span> SignInStatus.RequiresVerification:</div><div class="line">            <span class="keyword">return</span> RedirectToAction(<span class="string">"SendCode"</span>, <span class="keyword">new</span> &#123; ReturnUrl = returnUrl, RememberMe = <span class="literal">false</span> &#125;);</div><div class="line">        <span class="keyword">case</span> SignInStatus.Failure:</div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            ViewBag.ReturnUrl = returnUrl;</div><div class="line">            ViewBag.LoginProvider = loginInfo.Login.LoginProvider;</div><div class="line">            <span class="keyword">return</span> View(<span class="string">"ExternalLoginConfirmation"</span>, <span class="keyword">new</span> ExternalLoginConfirmationViewModel &#123; Email = loginInfo.Email, Name=loginInfo.DefaultUserName &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="ExternalLoginConfirmation-Action"><a href="#ExternalLoginConfirmation-Action" class="headerlink" title="ExternalLoginConfirmation Action"></a>ExternalLoginConfirmation Action</h3><img src="/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/12.JPG" alt="Modify ExternalLoginConfirmation Action" title="Modify ExternalLoginConfirmation Action">
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">[HttpPost]</div><div class="line">[AllowAnonymous]</div><div class="line">[ValidateAntiForgeryToken]</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;ActionResult&gt; <span class="title">ExternalLoginConfirmation</span>(<span class="params">ExternalLoginConfirmationViewModel model, <span class="keyword">string</span> returnUrl</span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (User.Identity.IsAuthenticated)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> RedirectToAction(<span class="string">"Index"</span>, <span class="string">"Manage"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (ModelState.IsValid)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">var</span> info = <span class="keyword">await</span> AuthenticationManager.GetExternalLoginInfoAsync();</div><div class="line">        <span class="keyword">if</span> (info == <span class="literal">null</span>)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">return</span> View(<span class="string">"ExternalLoginFailure"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">var</span> user = <span class="keyword">new</span> ApplicationUser &#123; UserName = model.Name, Email = model.Email &#125;;</div><div class="line">        <span class="keyword">var</span> result = <span class="keyword">await</span> UserManager.CreateAsync(user);</div><div class="line">        <span class="keyword">if</span> (result.Succeeded)</div><div class="line">        &#123;</div><div class="line">            result = <span class="keyword">await</span> UserManager.AddLoginAsync(user.Id, info.Login);</div><div class="line">            <span class="keyword">if</span> (result.Succeeded)</div><div class="line">            &#123;</div><div class="line">                <span class="keyword">await</span> SignInManager.SignInAsync(user, isPersistent: <span class="literal">false</span>, rememberBrowser: <span class="literal">false</span>);</div><div class="line">                <span class="keyword">return</span> RedirectToLocal(returnUrl);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        AddErrors(result);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    ViewBag.ReturnUrl = returnUrl;</div><div class="line">    <span class="keyword">return</span> View(model);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="View"><a href="#View" class="headerlink" title="View"></a>View</h1><h2 id="ExternalLoginConfirmation-cshtml"><a href="#ExternalLoginConfirmation-cshtml" class="headerlink" title="ExternalLoginConfirmation.cshtml"></a>ExternalLoginConfirmation.cshtml</h2><img src="/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/13.JPG" alt="Open ExternalLoginConfirmation.cshtml" title="Open ExternalLoginConfirmation.cshtml">
<img src="/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/14.JPG" alt="Add copy a Email div as Name div" title="Add copy a Email div as Name div">
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;div <span class="keyword">class</span>=<span class="string">"form-group"</span>&gt;</div><div class="line">    @Html.LabelFor(m =&gt; m.Name, <span class="keyword">new</span> &#123; @<span class="keyword">class</span> = <span class="string">"col-md-2 control-label"</span> &#125;)</div><div class="line">    &lt;div <span class="keyword">class</span>=<span class="string">"col-md-10"</span>&gt;</div><div class="line">        @Html.TextBoxFor(m =&gt; m.Name, <span class="keyword">new</span> &#123; @<span class="keyword">class</span> = <span class="string">"form-control"</span> &#125;)</div><div class="line">        @Html.ValidationMessageFor(m =&gt; m.Name, <span class="string">""</span>, <span class="keyword">new</span> &#123; @<span class="keyword">class</span> = <span class="string">"text-danger"</span> &#125;)</div><div class="line">    &lt;/div&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<h1 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h1><h2 id="Login-cshtml"><a href="#Login-cshtml" class="headerlink" title="Login.cshtml"></a>Login.cshtml</h2><img src="/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/15.JPG" alt="Open Login.cshtml" title="Open Login.cshtml">
<h2 id="ctrl-F5"><a href="#ctrl-F5" class="headerlink" title="ctrl + F5"></a>ctrl + F5</h2><img src="/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/16.JPG" alt="find button on Login View" title="find button on Login View">
<img src="/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/17.JPG" alt="Find Name input on ExternalLoginConfirmation View" title="Find Name input on ExternalLoginConfirmation View">
<img src="/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/18.JPG" alt="Find your name on the right-top side" title="Find your name on the right-top side">
<h1 id="Database"><a href="#Database" class="headerlink" title="Database"></a>Database</h1><img src="/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/19.JPG" alt="Open server manager" title="Open server manager">
<img src="/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/20.JPG" alt="Right click on AspNetUser" title="Right click on AspNetUser">
<img src="/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/21.JPG" alt="Find UserName column and your name" title="Find UserName column and your name">
<h1 id="Notice-1"><a href="#Notice-1" class="headerlink" title="Notice"></a>Notice</h1><h2 id="Database-Column-Issue"><a href="#Database-Column-Issue" class="headerlink" title="Database Column Issue"></a>Database Column Issue</h2><p><strong><strong><em>If you want to truely use this in your website, I suggest you to add a column to your database. This will ask you to learn some code first database generation techniques which use datacase migration to done this work. There are two reasons for you to do that. First, email as login username is more rememberable. Second, If you want mix Identity inner-built login system, you also have to moidify general login code to write the match the column and user input</em></strong></strong></p>
<h2 id="Database-Storage-Issue"><a href="#Database-Storage-Issue" class="headerlink" title="Database Storage Issue"></a>Database Storage Issue</h2><p><strong><strong><em>Originally, its default path to database is app_Data built in your project. If you want to move to other place. you have first to modify the connecting string in web.config(in the bottom of your project manager). Then start your first login. If you have loggged in before. you had better delete all your migration log, then start migration mechanism.</em></strong></strong></p>
<h2 id="Publish-on-Azure"><a href="#Publish-on-Azure" class="headerlink" title="Publish on Azure"></a>Publish on Azure</h2><p><strong><strong><em>Even if I tried several times, I can’t get authorization from facebook Some times once I publish on azure. However, sometimes it works. Iam still deal with this problem</em></strong></strong><br><img src="/2017/06/25/Use-Facebook-API-to-login-Asp-Net-Identity/22FacebookError.JPG" alt="FacebookError" title="FacebookError"></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/C/" rel="tag"># C#</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/06/24/BackupMongodbPeroidically/" rel="prev" title="Backup mlab Mongodb To Local Peroidically by C#">
                Backup mlab Mongodb To Local Peroidically by C# <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目錄
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            本站概覽
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://scontent-tpe1-1.xx.fbcdn.net/v/t1.0-9/15622747_1207299666013163_2211742436901915922_n.jpg?oh=f0ebf41169212e1b6bbdc1eeb65a6258&oe=597989BB"
               alt="Jeremy Wang" />
          <p class="site-author-name" itemprop="name">Jeremy Wang</p>
           
              <p class="site-description motion-element" itemprop="description">a hardworking beginner of programming</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">文章</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">分類</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">標籤</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/jeremy4555" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.linkedin.com/in/%E9%81%B8%E4%BB%B2-%E7%8E%8B-35a164118/" target="_blank" title="Linkedin">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Linkedin
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.facebook.com/jeremy45555" target="_blank" title="Facebook">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Facebook
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Introduction"><span class="nav-number">1.</span> <span class="nav-text">Introduction</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Tools-on-Facebook-Api"><span class="nav-number">2.</span> <span class="nav-text">Tools on Facebook Api</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Notice"><span class="nav-number">3.</span> <span class="nav-text">Notice</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Open-Project-and-prepare-utility-for-Identity-class-to-use"><span class="nav-number">4.</span> <span class="nav-text">Open Project and prepare utility for Identity class to use</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Open-an-MVC-project-with-idntity"><span class="nav-number">4.1.</span> <span class="nav-text">Open an MVC project with idntity</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Create-FacebookBackChannelHandler-cs-class-file-in-fb-directory"><span class="nav-number">4.2.</span> <span class="nav-text">Create FacebookBackChannelHandler.cs class file in fb directory</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Modify-Startup-Auth"><span class="nav-number">4.3.</span> <span class="nav-text">Modify Startup.Auth</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Build-your-project"><span class="nav-number">4.4.</span> <span class="nav-text">Build your project</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Model-and-ViewModel"><span class="nav-number">5.</span> <span class="nav-text">Model and ViewModel</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Edit-database-column-and-IdentityModel-cs"><span class="nav-number">5.1.</span> <span class="nav-text">Edit database column and IdentityModel.cs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AccountViewModel-cs-get-username-from-view"><span class="nav-number">5.2.</span> <span class="nav-text">AccountViewModel.cs(get username from view)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Controller"><span class="nav-number">6.</span> <span class="nav-text">Controller</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#AccountController-cs-get-username-from-fb"><span class="nav-number">6.1.</span> <span class="nav-text">AccountController.cs(get username from fb)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ExternalLoginCallback-Action"><span class="nav-number">6.1.1.</span> <span class="nav-text">ExternalLoginCallback Action</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ExternalLoginConfirmation-Action"><span class="nav-number">6.1.2.</span> <span class="nav-text">ExternalLoginConfirmation Action</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#View"><span class="nav-number">7.</span> <span class="nav-text">View</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ExternalLoginConfirmation-cshtml"><span class="nav-number">7.1.</span> <span class="nav-text">ExternalLoginConfirmation.cshtml</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Usage"><span class="nav-number">8.</span> <span class="nav-text">Usage</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Login-cshtml"><span class="nav-number">8.1.</span> <span class="nav-text">Login.cshtml</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ctrl-F5"><span class="nav-number">8.2.</span> <span class="nav-text">ctrl + F5</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Database"><span class="nav-number">9.</span> <span class="nav-text">Database</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Notice-1"><span class="nav-number">10.</span> <span class="nav-text">Notice</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Database-Column-Issue"><span class="nav-number">10.1.</span> <span class="nav-text">Database Column Issue</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Database-Storage-Issue"><span class="nav-number">10.2.</span> <span class="nav-text">Database Storage Issue</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Publish-on-Azure"><span class="nav-number">10.3.</span> <span class="nav-text">Publish on Azure</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jeremy Wang</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 強力驅動
</div>

<div class="theme-info">
  主題 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  





  

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

</body>
</html>
